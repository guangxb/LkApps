//------------------------------------------------------------------------------
// <auto-generated>
//     此代码已从模板生成。
//
//     手动更改此文件可能导致应用程序出现意外的行为。
//     如果重新生成代码，将覆盖对此文件的手动更改。
// </auto-generated>
//------------------------------------------------------------------------------

using Apps.Models;
using Apps.Models.Sys;
using Apps.IRepository.Sys;
using System;
using System.Linq;
using System.Collections.Generic;

namespace Apps.Repository.Sys
{
    public partial class SysRoleRepository : BaseRepository<SysRole>, ISysRoleRepository
    {
        public IQueryable<SysUser> GetRefSysUser(string id)
        {
            if (!string.IsNullOrEmpty(id))
            {
                return from m in Context.SysRole
                       from f in m.SysUser
                       where m.Id == id
                       select f;
            }
            return null;
        }

        public IQueryable<P_Sys_GetUserByRoleId_Result> GetUserByRoleId(string roleId, string depId)
        {
            return Context.P_Sys_GetUserByRoleId(roleId, depId).ToList().AsQueryable();
        }

        public void UpdateSysRoleSysUser(string roleId, List<AssignUserModel> users)
        {
            SysRole role = Context.Set<SysRole>().Where(s => s.Id == roleId).FirstOrDefault();
            foreach (var item in users)
            {
                SysUser user = Context.Set<SysUser>().Where(u => u.Id == item.UserId).FirstOrDefault();
                if (item.Checked)
                {
                    role.SysUser.Add(user);
                }
                else if(!item.Checked){
                    role.SysUser.Remove(user);
                }
            }

            //Context.P_Sys_DeleteSysRoleSysUserByRoleId(roleId);
            //foreach (string userid in userIds)
            //{
            //    if (!string.IsNullOrWhiteSpace(userid))
            //    {
            //        Context.P_Sys_UpdateSysRoleSysUser(roleId, userid);
            //    }
            //}
            
        }
    }
}
